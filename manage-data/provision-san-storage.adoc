---
sidebar: sidebar 
permalink: manage-data/provision-san-storage.html 
keywords: provision storage,san, create storage units, luns, namespaces, nvme, add host, add host initiators, map host, host mapping, create, ontap 
summary: ASA R2でONTAPストレージをプロビジョニングして、SAN（SCSIおよびNVMe）ホストが指定したストレージユニット（LUNおよびNVMeネームスペース）に対してデータの読み取りと書き込みを行えるようにします。 
searchtitle: ONTAP System Managerを使用したSANストレージのプロビジョニング| ASA R2 
---
= ASA R2システムでのONTAP SANストレージのプロビジョニング
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
ストレージをプロビジョニングするときに、SANホストがASA R2ストレージシステムに対してデータの読み取りと書き込みを実行できるようにします。ストレージをプロビジョニングするには、ONTAPシステムマネージャを使用して、ストレージユニットを作成し、ホストイニシエータを追加し、ホストをストレージユニットにマッピングします。また、読み取り/書き込み処理を有効にするために、ホストで手順を実行する必要があります。



== ストレージユニットの作成

ASA r2 システムでは、ストレージ ユニットにより、SAN ホストがデータ操作に使用できるストレージ スペースが提供されます。ストレージ ユニットとは、SCSI ホストの場合は LUN、NVMe ホストの場合は NVMe 名前空間を指します。クラスターが SCSI ホストをサポートするように構成されている場合は、LUN を作成するように求められます。クラスターが NVMe ホストをサポートするように構成されている場合は、NVMe 名前空間を作成するように求められます。

ASA r2 ストレージ ユニットの最大容量は 128 TB です。参照link:https://hwu.netapp.com/["NetApp Hardware Universe"^]ASA r2 システムの最新のストレージ制限については、こちらをご覧ください。

ストレージ ユニット作成プロセスの一環として、ホスト イニシエーターをストレージ ユニットに追加してマップします。また、link:provision-san-storage.html#add-host-initiators["追加"]そしてlink:provision-san-storage.html#map-the-storage-unit-to-a-host["マッピング"]ストレージ ユニットを作成した後、ホスト イニシエーターを作成します。

ONTAP 9.18.1 以降では、ストレージ ユニットの作成時にスナップショット リザーブを変更し、スナップショットの自動削除を有効にすることができます。スナップショット予約とは、スナップショット専用に予約されているストレージ ユニット内のスペースの量です。スナップショットの自動削除でスナップショット予約が設定されている場合、スナップショットによって使用されるスペースがスナップショット予約を超えると、古いスナップショットが自動的に削除されます。

link:../data-protection/snapshot-reserve.html["ASA r2 システムのスナップショット予約の詳細"]。

ストレージ ユニットは、デフォルトでシン プロビジョニングされます。シン プロビジョニングでは、ストレージ ユニットは割り当てられたサイズまで拡張できますが、事前にスペースを予約しません。必要に応じて、使用可能な空き領域からスペースが動的に割り当てられます。これにより、使用可能なスペースを過剰にプロビジョニングすることで、ストレージ効率を向上させることができます。たとえば、1 TB の空き容量があり、4 つの 1 TB ストレージ ユニットを作成する必要があるとします。システムに 3 TB の追加ストレージ容量をすぐに追加する代わりに、ストレージ ユニットを作成し、スペースの使用率を監視し、ストレージ ユニットが実際のスペースを消費するにつれてストレージ容量を増やすことができます。詳細はこちらlink:https://docs.netapp.com/us-en/ontap/concepts/thin-provisioning-concept.html["シンプロビジョニング"^]。

.手順
. System Managerで、*[ストレージ]*を選択し、を選択しますimage:icon_add_blue_bg.png["青い背景を持つ長方形のアイコンと、白い文字の中央に「add」という単語が表示されます。"]。
. 新しいストレージ・ユニットの名前を入力します
. 作成する単位の数を入力します。
+
複数のストレージ・ユニットを作成する場合'各ユニットは同じ容量'ホスト・オペレーティング・システム'ホスト・マッピングを使用して作成されます

+
ストレージ可用性ゾーン全体でのワークロード分散を最適化するには、偶数個のストレージ ユニットを作成します。

. ストレージユニットの容量を入力し、ホストオペレーティングシステムを選択します。
+

CAUTION: 複数のストレージ ユニットを作成する場合、各ユニットは同じ容量で作成されます。作成するストレージ ユニットの数に必要な容量を掛けて、使用可能なスペースが十分にあることを確認します。十分な空き容量がなく、過剰にプロビジョニングすることを選択した場合は、容量不足やデータの損失を回避するために、使用率を注意深く監視してください。

. 自動選択された*ホストマッピング*を受け入れるか、マッピング先のストレージユニットに別のホストグループを選択してください。
+
*ホスト マッピング* は、新しいストレージ ユニットがマップされるホスト グループを指します。新しいストレージ ユニットに選択したホストの種類に既存のホスト グループがある場合は、その既存のホスト グループがホスト マッピングに自動的に選択されます。自動的に選択されたホスト グループを受け入れることも、別のホスト グループを選択することもできます。

+
指定したオペレーティング システムで実行されているホストに既存のホスト グループが存在しない場合は、 ONTAP新しいホスト グループが自動的に作成されます。

. 次のいずれかを実行する場合は、*[その他のオプション]*を選択し、必要な手順を実行します。
+
[cols="2, 4a"]
|===
| オプション | 手順 


 a| 
デフォルトのQoSポリシーを変更する

ストレージユニットを作成するStorage Virtual Machine（VM）にデフォルトのQoSポリシーがまだ設定されていない場合、このオプションは使用できません。
 a| 
.. [ストレージと最適化]*で、*[Quality of Service（QoS）]*の横にあるを選択しますimage:icon_dropdown_arrow.gif["下向きを指している青い矢印のアイコン"]。
.. 既存の QoS ポリシーを選択してください。




 a| 
新しいQoSポリシーを作成します。
 a| 
.. [ストレージと最適化]*で、*[Quality of Service（QoS）]*の横にあるを選択しますimage:icon_dropdown_arrow.gif["下向きを指している青い矢印のアイコン"]。
.. [新しいポリシーを定義する]*を選択します。
.. 新しいQoSポリシーの名前を入力します。
.. QoS 制限、QoS 保証、またはその両方を設定します。
+
... 必要に応じて、* Limit *に、最大スループット制限、最大IOPS制限、またはその両方を入力します。
+
ストレージユニットに最大スループットとIOPSを設定すると、システムリソースへの影響が制限され、重要なワークロードのパフォーマンスが低下しないようになります。

... 必要に応じて、* Guarantee *に、最小スループット、最小IOPS、またはその両方を入力します。
+
ストレージユニットに最小スループットとIOPSを設定すると、競合するワークロードによる要求に関係なく、ストレージユニットは最小パフォーマンス目標を達成できます。



.. 「 * 追加」を選択します。




 a| 
デフォルトのパフォーマンスサービスレベルを変更
 a| 
.. [ストレージと最適化]*で、*[パフォーマンスサービスレベル]*の横にあるを選択しますimage:icon_dropdown_arrow.gif["下向きを指している青い矢印のアイコン"]。
.. [パフォーマンス]*を選択します。
+
ASA r2 システムには 2 つのパフォーマンス レベルがあります。デフォルトのパフォーマンス レベルは *Extreme* で、これは利用可能な最高レベルです。レベルを*パフォーマンス*に下げることもできます。





 a| 
デフォルトのスナップショット予約を変更し、スナップショットの自動削除を有効にします。
 a| 
.. *スナップショット予約率 %* の下に、スナップショットに割り当てるストレージ ユニット領域の割合を表す数値を入力します。
.. *古いスナップショットを自動的に削除する*を選択します。




 a| 
新しいSCSIホストを追加します。
 a| 
.. [ホスト情報]*で、接続プロトコルとして*[SCSI]*を選択します。
.. ホストオペレーティングシステムを選択します。
.. [ホストマッピング]*で*[新しいホスト]*を選択します。
.. [FC]*または*[iSCSI]*を選択します。
.. 既存のホストイニシエータを選択するか、*イニシエータの追加*を選択して新しいホストイニシエータを追加します。
+
有効なFC WWPNの例は「01：02：03：04：0a：0b：0c：0d」です。有効なiSCSIイニシエータ名の例としては、「iqn.1995-08.com.example:string"」および「eui.0123456789abcdef」があります。





 a| 
新しいSCSIホストグループを作成する
 a| 
.. [ホスト情報]*で、接続プロトコルとして*[SCSI]*を選択します。
.. ホストオペレーティングシステムを選択します。
.. [ホストマッピング]*で*[新しいホストグループ]*を選択します。
.. ホストグループの名前を入力し、グループに追加するホストを選択します。




 a| 
新しいNVMeサブシステムを追加する
 a| 
.. [ホスト情報]*で、接続プロトコルとして*[NVMe]*を選択します。
.. ホストオペレーティングシステムを選択します。
.. [ホストマッピング]*で*[新しいNVMeサブシステム]*を選択します。
.. サブシステムの名前を入力するか、デフォルトの名前をそのまま使用します。
.. イニシエータの名前を入力します。
.. インバンド認証またはTransport Layer Security（TLS）を有効にする場合は、を選択しimage:icon_dropdown_arrow.gif["下向きを指している青い矢印のアイコン"]、オプションを選択します。
+
インバンド認証を使用すると、NVMeホストとASA R2システムの間でセキュアな双方向認証と一方向認証を確立できます。

+
TLSは、NVMe/TCPホストとASA R2システムの間でネットワーク経由で送信されるすべてのデータを暗号化します。

.. イニシエータをさらに追加する場合は、*[イニシエータの追加]*
+
ホスト NQN を <nqn.yyyy-mm> の後に完全修飾ドメイン名を続けてフォーマットします。年は 1970 年以降である必要があります。合計最大長は 223 になります。有効なNVMeイニシエーターの例はnqn.2014-08.com.example:stringです。



|===
. 「 * 追加」を選択します。


.次の手順
ストレージユニットが作成され、ホストにマッピングされます。これで、link:../data-protection/create-snapshots.html["スナップショットの作成"]ASA R2システム上のデータを保護できます。

.詳細情報
詳細については、をご覧ください link:../administer/manage-client-vm-access.html["ASA R2システムでのStorage Virtual Machineの使用方法"]。



== ホストイニシエータの追加

ASA R2システムには、いつでも新しいホストイニシエータを追加できます。イニシエータは、ホストがストレージユニットにアクセスしてデータ処理を実行できるようにします。

.開始する前に
ホストイニシエータの追加プロセス中にデスティネーションクラスタにホスト設定をレプリケートする場合は、クラスタがレプリケーション関係にある必要があります。必要に応じて、link:../data-protection/snapshot-replication.html#step-3-create-a-replication-relationship["レプリケーション関係を作成する"]ホストを追加したあとに実行できます。

SCSIホストまたはNVMeホストのホストイニシエータを追加します。

[role="tabbed-block"]
====
.SCSIホスト
--
.手順
. [ホスト]*を選択します。
. [SCSI]*を選択し、を選択しimage:icon_add_blue_bg.png["プラス記号の後に白い文字で追加された単語が続く青い四角形のアイコン"]ます。
. ホスト名を入力し、ホストオペレーティングシステムを選択して、ホストの説明を入力します。
. ホスト設定をデスティネーションクラスタにレプリケートする場合は、*[ホスト設定をレプリケート]*を選択してから、デスティネーションクラスタを選択します。
+
ホスト設定をレプリケートするには、クラスタがレプリケーション関係にある必要があります。

. 新規または既存のホストを追加します。
+
[cols="2"]
|===
| 新しいホストの追加 | 既存のホストを追加 


 a| 
.. [新しいホスト]*を選択します。
.. [FC]*または*[iSCSI]*を選択し、ホストイニシエータを選択します。
.. 必要に応じて、*ホストプロキシミティの設定*を選択します。
+
ホストのプロキシミティを設定すると、ONTAPがホストに最も近いコントローラを特定して、データパスの最適化とレイテンシの削減を実現できるようになります。これは、データをリモートサイトにレプリケートした場合にのみ該当します。Snapshotレプリケーションを設定していない場合は、このオプションを選択する必要はありません。

.. 新しいイニシエータを追加する必要がある場合は、*[イニシエータの追加]*を選択します。

 a| 
.. [既存のホスト]*を選択します。
.. 追加するホストを選択します。
.. 「 * 追加」を選択します。


|===
. 「 * 追加」を選択します。


.次の手順
ASA R2システムにSCSIホストが追加され、ホストをストレージユニットにマッピングする準備が整いました。

--
.NVMeホスト
--
.手順
. [ホスト]*を選択します。
. [NVMe]*を選択し、を選択しimage:icon_add_blue_bg.png["青い背景を持つ長方形のアイコンと、白い文字の中央に「add」という単語が表示されます。"]ます。
. NVMeサブシステムの名前を入力し、ホストオペレーティングシステムを選択して説明を入力します。
. [Add initiator]*を選択します。


.次の手順
NVMeホストがASA R2システムに追加され、ホストをストレージユニットにマッピングする準備が完了しました。

--
====


== ストレージ・ユニットのホストへのマッピング

ASA r2 ストレージ ユニットを作成し、ホスト イニシエーターを追加したら、ホストをストレージ ユニットにマップしてデータの提供を開始します。ストレージ ユニットは、ストレージ ユニット作成プロセスの一環としてホストにマップされます。既存のストレージ ユニットをいつでも新規または既存のホストにマップすることもできます。

.手順
. [ストレージ]*を選択します。
. マッピングするストレージ・ユニットの名前にカーソルを合わせます
. を選択しimage:icon_kabob.gif["3つの垂直な青い点"]、*[ホストにマッピング]*を選択します。
. ストレージユニットにマッピングするホストを選択し、*[マップ]*を選択します。


.次の手順
ストレージユニットがホストにマッピングされ、ホストでプロビジョニングプロセスを完了できる状態になります。



== ホスト側の完全なプロビジョニング

ストレージユニットを作成し、ホストイニシエータを追加し、ストレージユニットをマッピングしたら、ASA R2システムでデータの読み取りと書き込みを行う前に、ホストで実行する必要があります。

.手順
. FCおよびFC / NVMeの場合は、FCスイッチをWWPNでゾーニングします。
+
イニシエータごとに1つのゾーンを使用し、各ゾーンにすべてのターゲットポートを含めます。

. 新しいストレージユニットを検出します。
. ストレージ・ユニットとCREATE FILE SYSTEMを初期化します
. ホストがストレージユニットのデータを読み取りおよび書き込みできることを確認します。


.次の手順
プロビジョニングプロセスが完了し、データの提供を開始する準備ができました。これで、link:../data-protection/create-snapshots.html["スナップショットの作成"]ASA R2システム上のデータを保護できます。

.詳細情報
ホスト側の設定の詳細についてはlink:https://docs.netapp.com/us-en/ontap-sanhost/["ONTAP SANホストのドキュメント"^]、使用しているホストのを参照してください。
