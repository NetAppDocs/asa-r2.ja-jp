---
sidebar: sidebar 
permalink: data-protection/snapshot-replication.html 
keywords: snapshot replication, asa r2, protect data, data protection, replication, replicate data, remote cluster, destination cluster, source cluster, replication relationship, asynchronous replication, synchronous replication 
summary: ONTAP System Managerを使用して、バックアップおよびディザスタリカバリ用にデータをリモートサイトにコピーします。設定するには、レプリケーションポリシーと関係を作成する必要があります。 
searchtitle: ONTAP System Managerを使用したリモートクラスタへのSnapshotのレプリケート| ASA R2 
---
= ASA R2ストレージシステムからリモートクラスタにSnapshotをレプリケート
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
Snapshotレプリケーションは、ASA R2システム上の整合グループを地理的に離れた場所にコピーするプロセスです。最初のレプリケーションの後、コンシステンシグループへの変更は、レプリケーションポリシーに基づいてリモートロケーションにコピーされます。レプリケートされた整合グループは、ディザスタリカバリまたはデータ移行に使用できます。


NOTE: ASA R2ストレージシステムのSnapshotレプリケーションは、別のASA R2ストレージシステムとの間でのみサポートされます。ASA R2システムから現在のASA、AFF、またはFASシステムに、または現在のASA、AFF、またはFASシステムからASA R2システムにSnapshotをレプリケートすることはできません。

Snapshotレプリケーションを設定するには、ASA R2システムとリモートサイトの間にレプリケーション関係を確立する必要があります。レプリケーション関係はレプリケーションポリシーによって管理されます。すべてのSnapshotをレプリケートするデフォルトポリシーは、クラスタのセットアップ時に作成されます。デフォルトのポリシーを使用することも、必要に応じて新しいポリシーを作成することもできます。



== 手順1：クラスタピア関係を作成する

データをリモートクラスタにレプリケートして保護するには、ローカルクラスタとリモートクラスタの間にクラスタピア関係を作成する必要があります。

.手順
. ローカルクラスタで、System Managerで*[クラスタ]>[設定]*を選択します。
. [クラスタピア]*の横にある*[クラスタ間設定]*でを選択しimage:icon_kabob.gif["3つの垂直な青い点"]、*[クラスタピアの追加]*を選択します。
. [Lauch remote cluster]*を選択します。これにより、リモートクラスタでの認証に使用するパスフレーズが生成されます。
. リモートクラスタのパスフレーズが生成されたら、ローカルクラスタの*[パスフレーズ]*に貼り付けます。
. を選択image:icon_add.gif["青色のプラス記号の後に青色の文字で「add」という単語が続く"]し、クラスタ間ネットワークインターフェイスのIPアドレスを入力します。
. [クラスタピアリングの開始]*を選択します。


.次の手順
ローカルASA R2クラスタとリモートクラスタのピア関係を設定しておきます。レプリケーション関係を作成できるようになりました。



== 手順2：必要に応じて、レプリケーションポリシーを作成します。

Snapshotレプリケーションポリシーは、ASA R2クラスタで実行される更新をリモートサイトにレプリケートするタイミングを定義します。

.手順
. System Managerで、*[保護]>[ポリシー]*を選択し、*[レプリケーションポリシー]*を選択します。
. を選択します image:icon_add_blue_bg.png["プラス記号が付いた青い四角形の後に、白い文字で「add」という単語が続く"]。
. レプリケーションポリシーの名前を入力するか、デフォルトの名前をそのまま使用してから、説明を入力します。
. [ポリシーの範囲]*を選択します。
+
レプリケーションポリシーをクラスタ全体に適用する場合は、*[クラスタ]*を選択します。レプリケーションポリシーを特定のStorage VMのストレージユニットにのみ適用する場合は、*[Storage VM]*を選択します。

. [ポリシータイプ]*を選択します。
+
[cols="2,6a"]
|===
| オプション | 手順 


| ソースに書き込まれたデータをリモートサイトにコピーします。  a| 
.. [非同期]*を選択します。
.. [ソースからSnapshotを転送]*で、デフォルトの転送スケジュールをそのまま使用するか、別の転送スケジュールを選択します。
.. すべてのスナップショットを転送するか、転送するスナップショットを決定するルールを作成する場合に選択します。
.. 必要に応じて、ネットワーク圧縮を有効にします。




| ソースサイトとリモートサイトに同時にデータを書き込みます。  a| 
.. [同期]*を選択します。


|===
. [ 保存（ Save ） ] を選択します。


.次の手順
これでレプリケーションポリシーが作成され、ASA R2システムとリモートサイトの間にレプリケーション関係を作成できるようになりました。

.詳細情報
詳細については、をご覧ください link:../administer/manage-client-vm-access.html["クライアントアクセスヨウノStorage VM"]。



== 手順3：レプリケーション関係を作成する

Snapshotレプリケーション関係により、ASA R2システムとリモートサイトの間に接続が確立され、リモートクラスタに整合グループをレプリケートできるようになります。レプリケートされた整合グループは、ディザスタリカバリまたはデータ移行に使用できます。

ランサムウェア攻撃から保護するために、レプリケーション関係を設定するときに、デスティネーションSnapshotをロックするように選択できます。ロックされたSnapshotは、誤ってまたは悪意を持って削除することはできません。ロックされたSnapshotを使用して、ランサムウェア攻撃によってストレージユニットが侵害された場合にデータをリカバリできます。

.開始する前に
デスティネーションSnapshotをロックする場合は、link:../secure-data/ransomware-protection.html#initialize-the-snaplock-compliance-clock["Snapshotコンプライアンスクロックを初期化する"]レプリケーション関係を作成する前にロックする必要があります。

ロックされたデスティネーションSnapshotを使用するかどうかに関係なく、レプリケーション関係を作成します。

[role="tabbed-block"]
====
.ロックされたSnapshotあり
--
.手順
. System Managerで、*[保護]>[整合グループ]*を選択します。
. 整合グループを選択します。
. を選択しimage:icon_kabob.gif["3つの垂直な青い点"]、* Protect *を選択します。
. [リモート保護]*で、*[リモートクラスタにレプリケート]*を選択します。
. [レプリケーションポリシー]*を選択します。
+
_vault_replicationポリシーを選択する必要があります。

. [デスティネーションの設定]*を選択します。
. [デスティネーションSnapshotをロックして削除を防止する]*を選択します。
. 最大および最小のデータ保持期間を入力します。
. データ転送の開始を遅らせるには、*[すぐに転送を開始する]*の選択を解除します。
+
デフォルトでは、最初のデータ転送がすぐに開始されます。

. 必要に応じて、デフォルトの転送スケジュールを上書きするには、*デスティネーション設定*を選択し、*転送スケジュールを上書き*を選択します。
+
転送スケジュールがサポートされるまでに30分以上かかる必要があります。

. [ 保存（ Save ） ] を選択します。


--
.ロックされたSnapshotなし
--
.手順
. System Managerで、*[保護]>[レプリケーション]*を選択します。
. ローカルデスティネーションまたはローカルソースとのレプリケーション関係を作成する場合に選択します。
+
[cols="2,2"]
|===
| オプション | 手順 


| ローカル保存先  a| 
.. [ローカルデスティネーション]*を選択し、を選択しますimage:icon_replicate_blue_bg.png["青の背景と白の文字で複製される単語の長方形"]。
.. ソース整合性グループを検索して選択します。
+
_source_consistencyグループは、レプリケートするローカルクラスタ上の整合グループです。





| ローカルソース  a| 
.. [Local sources]*を選択し、を選択しますimage:icon_replicate_blue_bg.png["青の背景と白の文字で複製される単語の長方形"]。
.. ソース整合性グループを検索して選択します。
+
_source_consistencyグループは、レプリケートするローカルクラスタ上の整合グループです。

.. [レプリケーションのデスティネーション]*で、レプリケート先のクラスタを選択し、Storage VMを選択します。


|===
. レプリケーションポリシーを選択します。
. データ転送の開始を遅らせるには、*送信先設定*を選択し、*すぐに転送を開始*の選択を解除します。
+
デフォルトでは、最初のデータ転送がすぐに開始されます。

. 必要に応じて、デフォルトの転送スケジュールを上書きするには、*デスティネーション設定*を選択し、*転送スケジュールを上書き*を選択します。
+
転送スケジュールがサポートされるまでに30分以上かかる必要があります。

. [ 保存（ Save ） ] を選択します。


--
====
.次の手順
レプリケーションポリシーと関係を作成したので、レプリケーションポリシーの定義に従って最初のデータ転送が開始されます。必要に応じて、レプリケーションフェイルオーバーをテストして、ASA R2システムがオフラインになった場合にフェイルオーバーが正常に実行されることを確認できます。



== 手順4：レプリケーションのフェイルオーバーをテストする

必要に応じて、ソースクラスタがオフラインの場合に、リモートクラスタ上のレプリケートされたストレージユニットからデータを正常に提供できることを検証します。

.手順
. System Managerで、*[保護]>[レプリケーション]*を選択します。
. テストするレプリケーション関係にカーソルを合わせ、を選択しますimage:icon_kabob.gif["3つの垂直な青い点"]。
. [Test failover]*を選択します。
. フェイルオーバー情報を入力し、*[Test failover]*を選択します。


.次の手順
ディザスタリカバリのためにスナップショットレプリケーションを使用してデータを保護したので、link:../secure-data/encrypt-data-at-rest.html["保存データを暗号化"]ASA R2システム内のディスクの転用、返却、置き忘れ、盗難に際してデータが読み取られないようにする必要があります。
